<template>
  <div class="zen-bg">
    <MonkAuth v-if="!user" @auth="handleAuth" />
    <template v-else>
      <!-- Main app content below, only visible if authenticated -->
      <div class="zen-header" v-if="!meditationActive">
        <div class="zen-header-left">
       <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="70" viewBox="0 0 2560 747" preserveAspectRatio="xMidYMid meet">
<path d="M0 0 C7.40443444 2.84606347 14.86212708 5.3102454 22.47143555 7.55224609 C17.62469062 20.21585292 6.67371531 31.26378882 -2.37231445 41.17724609 C-4.31417926 43.31611167 -6.20834042 45.48643994 -8.09106445 47.67724609 C-14.92022958 55.4753088 -22.38343316 62.14780819 -30.52856445 68.55224609 C-31.46700195 69.29603516 -32.40543945 70.03982422 -33.37231445 70.80615234 C-41.05193662 76.74134421 -49.06835641 81.82498269 -57.52856445 86.55224609 C-58.46394043 87.0764917 -58.46394043 87.0764917 -59.41821289 87.61132812 C-102.27299067 111.23810685 -151.96965245 111.61828189 -198.27856445 98.86474609 C-206.2356567 96.54200429 -213.92294406 93.56331661 -221.59106445 90.42724609 C-222.62134766 90.00741455 -223.65163086 89.58758301 -224.71313477 89.1550293 C-225.67445313 88.74728271 -226.63577148 88.33953613 -227.6262207 87.91943359 C-228.47708252 87.55962402 -229.32794434 87.19981445 -230.20458984 86.82910156 C-232.79645075 85.405062 -234.5410593 83.72569486 -236.52856445 81.55224609 C-234.74587093 80.16803701 -232.9499153 78.814287 -231.12158203 77.49047852 C-229.34426939 76.16197036 -227.61715521 74.76437408 -225.93847656 73.31323242 C-218.53335455 67.42747143 -218.53335455 67.42747143 -213.1472168 67.76269531 C-210.08759251 68.66101648 -207.16270913 69.68884021 -204.22891235 70.9380188 C-200.9969351 72.31056813 -197.69688791 73.50031648 -194.40356445 74.71630859 C-193.74310623 74.96552567 -193.08264801 75.21474274 -192.4021759 75.47151184 C-186.0122312 77.84483014 -179.53779089 79.35428801 -172.84106445 80.61474609 C-171.8579126 80.80512451 -170.87476074 80.99550293 -169.86181641 81.19165039 C-129.36155948 88.60493864 -88.02471466 80.45472386 -53.90356445 57.11474609 C-43.13398528 49.43228918 -33.28392445 40.67198539 -24.21606445 31.05224609 C-23.67054932 30.47692139 -23.12503418 29.90159668 -22.56298828 29.30883789 C-19.75338968 26.24066792 -17.75860609 23.54801771 -16.52856445 19.55224609 C-31.96723632 13.27759035 -47.96205991 8.67236424 -64.52856445 6.55224609 C-65.76606445 6.38595703 -65.76606445 6.38595703 -67.02856445 6.21630859 C-106.92636219 1.71564239 -146.83595413 12.30937216 -182.52856445 29.55224609 C-183.39126953 29.96313477 -184.25397461 30.37402344 -185.14282227 30.79736328 C-202.23295695 38.96493769 -218.49740691 48.41798729 -234.65356445 58.28662109 C-249.61170096 67.40561793 -264.81748282 75.79578417 -280.52856445 83.55224609 C-281.35372559 83.96055664 -282.17888672 84.36886719 -283.02905273 84.78955078 C-329.42991072 107.41185424 -383.99440155 115.04427688 -433.52856445 98.55224609 C-434.76219727 98.14490234 -435.99583008 97.73755859 -437.2668457 97.31787109 C-480.87435802 82.25603005 -517.85975717 47.5230044 -541.52856445 8.55224609 C-535.65353158 5.27797733 -529.34126874 3.38006412 -522.96606445 1.30224609 C-520.52322442 0.50056395 -518.08051738 -0.30152355 -515.63793945 -1.10400391 C-514.43073242 -1.49974609 -513.22352539 -1.89548828 -511.97973633 -2.30322266 C-508.92878891 -3.31502525 -505.89060487 -4.35496115 -502.85668945 -5.41650391 C-494.04478191 -8.48520844 -485.2515043 -11.16623989 -476.15356445 -13.26025391 C-475.31075928 -13.45522461 -474.4679541 -13.65019531 -473.59960938 -13.85107422 C-459.61794868 -16.90867777 -445.91079818 -17.85560067 -431.65356445 -17.82275391 C-430.80161499 -17.82254242 -429.94966553 -17.82233093 -429.07189941 -17.82211304 C-414.58491079 -17.78638158 -400.69380143 -16.65562391 -386.52856445 -13.44775391 C-385.70130859 -13.26583496 -384.87405273 -13.08391602 -384.02172852 -12.89648438 C-361.86180993 -7.89911459 -340.8791838 0.59242941 -320.52856445 10.55224609 C-319.59077148 11.01083008 -318.65297852 11.46941406 -317.68676758 11.94189453 C-303.21080743 19.09905976 -289.44845482 27.28781339 -275.72387695 35.76708984 C-273.66011156 37.03099721 -271.5951111 38.29289135 -269.52856445 39.55224609 C-268.64523437 40.0963916 -267.7619043 40.64053711 -266.85180664 41.20117188 C-266.06193359 41.66894043 -265.27206055 42.13670898 -264.45825195 42.61865234 C-263.78777832 43.02156494 -263.11730469 43.42447754 -262.42651367 43.83959961 C-259.98038363 44.75807833 -258.95239054 44.47998743 -256.52856445 43.55224609 C-255.01340792 42.7619175 -253.52674797 41.91581722 -252.0637207 41.03271484 C-251.19191162 40.5109668 -250.32010254 39.98921875 -249.421875 39.45166016 C-248.48770752 38.88672852 -247.55354004 38.32179688 -246.59106445 37.73974609 C-244.59957985 36.54976688 -242.60737436 35.36099342 -240.61450195 34.17333984 C-239.60097656 33.5686084 -238.58745117 32.96387695 -237.54321289 32.34082031 C-229.60378905 27.63040413 -221.58130804 23.06564599 -213.52856445 18.55224609 C-212.81458496 18.15054199 -212.10060547 17.74883789 -211.36499023 17.33496094 C-143.69388466 -20.47129585 -72.61747368 -27.91357504 0 0 Z M-503.52856445 19.55224609 C-501.8769678 23.62225214 -498.99806425 26.53247136 -496.02856445 29.67724609 C-495.21681763 30.5415625 -495.21681763 30.5415625 -494.38867188 31.42333984 C-493.28610427 32.59284268 -492.18089657 33.75986243 -491.07299805 34.92431641 C-489.74075299 36.32858609 -488.42414457 37.74766018 -487.1105957 39.16943359 C-460.94098909 66.64526841 -422.36610818 83.58524557 -384.5480957 84.75537109 C-348.84474957 85.29534704 -316.65869448 75.33133816 -284.52856445 60.55224609 C-284.52856445 59.56224609 -284.52856445 58.57224609 -284.52856445 57.55224609 C-286.64398617 55.94755213 -288.69419421 54.59457895 -290.96606445 53.23974609 C-292.0195105 52.59875977 -292.0195105 52.59875977 -293.09423828 51.94482422 C-332.35453935 28.30924542 -375.77867283 6.41097672 -422.52856445 4.55224609 C-423.17921875 4.52501465 -423.82987305 4.4977832 -424.50024414 4.46972656 C-451.62704091 3.48812422 -478.71770265 8.49906595 -503.52856445 19.55224609 Z " fill="currentColor" transform="translate(976.528564453125,436.44775390625)"/>
<path d="M0 0 C2.95837144 1.29802084 4.68321036 2.49800106 6.59375 5.09765625 C7.06031006 5.72526855 7.52687012 6.35288086 8.00756836 6.99951172 C8.5000708 7.68029785 8.99257324 8.36108398 9.5 9.0625 C10.02408447 9.77422363 10.54816895 10.48594727 11.08813477 11.21923828 C15.27345419 16.92927677 19.36883293 22.70421316 23.42773438 28.50463867 C26.51829512 32.92051284 29.66597177 37.28766194 32.85742188 41.63110352 C61.24982076 80.41744986 81.49505399 122.66586794 81.375 171.4375 C81.37445618 172.27149323 81.37391235 173.10548645 81.37335205 173.9647522 C81.33249292 187.63245956 80.44546842 200.71448498 77 214 C76.68651611 215.22009766 76.68651611 215.22009766 76.36669922 216.46484375 C68.19952351 247.05351683 51.34200026 278.27286403 24.15234375 295.83984375 C14.18952579 301.57091625 3.70121643 305.15702424 -7.7890625 302.30859375 C-19.03127208 298.52424433 -27.516049 292.12931639 -36 284 C-36.73992188 283.33484375 -37.47984375 282.6696875 -38.2421875 281.984375 C-57.46313459 264.0630649 -67.98726289 238.15009799 -74.75 213.3125 C-74.94891846 212.58933594 -75.14783691 211.86617187 -75.3527832 211.12109375 C-78.69929738 198.21167483 -79.41014289 185.32138765 -79.375 172.0625 C-79.37412384 171.25085388 -79.37324768 170.43920776 -79.37234497 169.60296631 C-79.27159197 141.20038287 -72.60599263 114.48084792 -60 89 C-59.67918457 88.3512793 -59.35836914 87.70255859 -59.02783203 87.03417969 C-45.86688057 60.79248571 -27.76565277 37.25478821 -10.4375 13.6875 C-9.85379639 12.89303467 -9.27009277 12.09856934 -8.66870117 11.2800293 C-5.85056904 7.45821268 -3.00383769 3.67951756 0 0 Z M1 39 C-4.04942367 44.18499048 -8.32160662 49.98517299 -12.5 55.875 C-13.06968506 56.67381592 -13.63937012 57.47263184 -14.22631836 58.2956543 C-15.33848021 59.85630698 -16.44915215 61.41802283 -17.55810547 62.98095703 C-18.67903039 64.55055559 -19.82160973 66.10469902 -20.97265625 67.65234375 C-48.86032184 105.54393851 -61.73727261 151.35171026 -55 198 C-50.00426265 227.42489298 -35.55596832 257.98868928 -11.16015625 276.109375 C-6.99139587 278.74227629 -3.04259272 281.10962158 2 281 C13.52750504 278.21749878 22.87351079 269.10451082 30 260 C30.77859375 259.02933594 31.5571875 258.05867187 32.359375 257.05859375 C54.87694957 227.96126571 62.51221044 188.90151302 58.17553711 152.88037109 C52.69271617 113.1548077 33.29603014 80.89749032 9.67480469 49.24804688 C8.53428681 47.71715932 7.39974318 46.1818069 6.27050781 44.64257812 C5.73006836 43.90974609 5.18962891 43.17691406 4.6328125 42.421875 C3.90795654 41.4333252 3.90795654 41.4333252 3.16845703 40.42480469 C2.78286621 39.95461914 2.39727539 39.48443359 2 39 C1.67 39 1.34 39 1 39 Z " fill="currentColor" transform="translate(716,126)"/>
<path d="M0 0 C1.07905758 42.58680572 -3.88851783 86.04357788 -22 125 C-22.27779297 125.61842773 -22.55558594 126.23685547 -22.84179688 126.87402344 C-30.22208873 143.26765462 -40.83114987 157.84828121 -53 171 C-53.81984375 171.89074219 -54.6396875 172.78148437 -55.484375 173.69921875 C-77.61238068 196.73114623 -110.37342451 215.1563306 -142.84375 216.11328125 C-146.23231542 216.12344695 -149.61277565 216.09019236 -153 216 C-153 212.02585915 -151.71692463 211.32707023 -149 208.5 C-145.58501077 204.90610532 -143.06167448 201.45283473 -140.5625 197.1875 C-136.40535298 191.31327051 -132.02659151 190.35842497 -125.34350586 188.84375 C-96.208468 182.16333071 -70.32494387 159.79460203 -54.34912109 135.16748047 C-35.3152296 104.58787702 -27.39046751 70.60726232 -25 35 C-51.77203559 46.20727994 -78.59241755 57.66731141 -100.5625 77.125 C-101.366875 77.74375 -102.17125 78.3625 -103 79 C-103.99 78.67 -104.98 78.34 -106 78 C-106.99 69.75 -107.98 61.5 -109 53 C-88.45508302 38.50849606 -66.81814143 27.527913 -43.95703125 17.16796875 C-39.4680127 15.13279709 -34.9935152 13.06975578 -30.52806091 10.9834137 C-27.51720555 9.57833975 -24.50201624 8.18271634 -21.48629761 6.78811646 C-20.0004653 6.09837509 -18.51649362 5.40461073 -17.03445435 4.70675659 C-14.94968454 3.72595268 -12.8586277 2.75995779 -10.765625 1.796875 C-10.14060593 1.49852249 -9.51558685 1.20016998 -8.87162781 0.89277649 C-5.57052222 -0.6073119 -3.43853933 -1.47122643 0 0 Z " fill="currentColor" transform="translate(921,209)"/>
<path d="M0 0 C4.29265874 0.50397847 7.98484019 2.18998842 11.86328125 3.9921875 C12.52382507 4.29395401 13.1843689 4.59572052 13.8649292 4.90663147 C16.01648436 5.89102025 18.16450878 6.88286168 20.3125 7.875 C21.80439924 8.55977707 23.29650717 9.24409965 24.78881836 9.92797852 C27.78554472 11.30208927 30.78094475 12.67903265 33.77539062 14.05810547 C37.49605573 15.77042126 41.22312738 17.46824955 44.953125 19.16015625 C89.17246557 39.23413592 89.17246557 39.23413592 108 54 C107.68860949 56.68763267 107.37591843 59.37510369 107.0625 62.0625 C106.97548828 62.81466797 106.88847656 63.56683594 106.79882812 64.34179688 C106.62381162 65.83916031 106.44497055 67.33608192 106.26220703 68.83251953 C106.09086405 70.24889106 105.92992505 71.66657043 105.78076172 73.08544922 C105.58917725 74.73307569 105.30325142 76.36922836 105 78 C104.01 78.495 104.01 78.495 103 79 C98.29516824 75.9331467 93.71162358 72.78724972 89.25 69.375 C76.77317281 60.28523393 62.86824175 53.25319008 49 46.5625 C47.99888184 46.0787793 46.99776367 45.59505859 45.96630859 45.09667969 C38.77779674 41.69115917 31.45656311 38.76539271 24 36 C27.56039433 78.00644564 37.02665783 124.06026528 68.625 154.6875 C69.800625 155.8321875 69.800625 155.8321875 71 157 C71 157.66 71 158.32 71 159 C71.59361328 159.26296875 72.18722656 159.5259375 72.79882812 159.796875 C75.09930049 161.05427605 76.452076 162.32979619 78.21875 164.25 C81.96518437 168.10005915 86.01715748 171.06224322 90.5 174 C91.28681152 174.51763916 92.07362305 175.03527832 92.88427734 175.56860352 C105.05578397 183.41489148 119.28058766 190.37503947 133.7890625 192.38671875 C136.73590107 193.20412804 137.25627853 194.31426692 138.75 196.9375 C141.68140893 201.70389478 145.1401423 205.65289873 148.94921875 209.73828125 C150.77395346 211.75070296 152.41287186 213.79817461 154 216 C152.28474682 217.71525318 150.16651008 217.25463947 147.8125 217.3125 C119.53437086 216.97254435 90.22734906 205.66140577 69 187 C67.87068011 186.05986242 66.73898933 185.12256854 65.60546875 184.1875 C58.46314655 178.25392269 51.97269 172.14028353 46 165 C45.25234375 164.13890625 44.5046875 163.2778125 43.734375 162.390625 C38.04107879 155.69035123 33.31303684 148.65168134 29 141 C28.56896973 140.23896973 28.13793945 139.47793945 27.69384766 138.69384766 C4.82005358 97.86095834 -3.62896035 47.54806259 -1 1 C-0.67 0.67 -0.34 0.34 0 0 Z " fill="currentColor" transform="translate(514,208)"/>
<path d="M0 0 C6.27 0 12.54 0 19 0 C19 50.49 19 100.98 19 153 C12.73 153 6.46 153 0 153 C-0.33 148.71 -0.66 144.42 -1 140 C-2.464375 141.2375 -3.92875 142.475 -5.4375 143.75 C-18.13750174 153.88850632 -32.24977486 155.25399882 -48 154 C-56.90820268 152.72272094 -64.72331326 149.2088513 -72 144 C-72.63421875 143.54882812 -73.2684375 143.09765625 -73.921875 142.6328125 C-84.54623291 134.31196582 -90.76056442 120.97837534 -92.71875 107.8359375 C-94.4174008 90.70787526 -90.94480461 75.40387461 -81.03515625 61.1796875 C-72.90915352 51.28321491 -60.74868895 44.46602737 -48 43 C-28.780021 41.69819951 -16.2367952 44.81056384 -1 57 C-0.67 38.19 -0.34 19.38 0 0 Z M-65.25 72.125 C-72.5378153 81.38194646 -74.572061 92.3237415 -73.8125 103.84375 C-72.30532553 114.77076491 -67.34813959 124.12460717 -58.828125 131.15234375 C-50.21764571 136.77769831 -40.09483181 138.23199691 -30 137 C-20.00951497 134.66932328 -12.22264722 129.59945286 -6.31640625 121.21484375 C-0.55068599 111.51406219 1.67899344 100.76534467 -0.71875 89.67578125 C-3.74911387 79.15504216 -7.92417965 71.38548789 -17 65 C-33.3076023 56.14883428 -52.28773498 58.56752893 -65.25 72.125 Z " fill="currentColor" transform="translate(1863,281)"/>
<path d="M0 0 C3.50590487 2.85912587 6.93452154 5.78639078 10.265625 8.84765625 C8.73314451 12.4316832 6.5981649 14.87615759 3.890625 17.66015625 C2.73433594 18.87638672 2.73433594 18.87638672 1.5546875 20.1171875 C-0.734375 21.84765625 -0.734375 21.84765625 -2.76953125 21.8125 C-5.09680461 20.66968386 -6.83006058 19.28874903 -8.796875 17.59765625 C-16.15792164 11.71123636 -24.43609897 8.24637128 -33.734375 6.84765625 C-34.54003906 6.71359375 -35.34570312 6.57953125 -36.17578125 6.44140625 C-51.54461019 4.42582213 -68.09180326 7.8974322 -80.671875 17.16015625 C-82.05656047 18.35483789 -83.41159914 19.58476985 -84.734375 20.84765625 C-85.43046875 21.50378906 -86.1265625 22.15992188 -86.84375 22.8359375 C-97.81276971 34.11423408 -101.10974562 47.860745 -101.03515625 63.04589844 C-100.68917975 77.95377884 -95.33589427 89.82405596 -85.078125 100.62890625 C-73.08925524 111.97836963 -57.63939234 116.20374241 -41.42724609 115.78857422 C-32.7755456 115.28533085 -24.47911227 113.93839154 -16.734375 109.84765625 C-15.88109619 109.55262207 -15.02781738 109.25758789 -14.14868164 108.95361328 C-11.26292372 106.43641763 -11.33106988 105.79154927 -11.07495117 102.10083008 C-11.0337537 100.08580784 -11.01968179 98.07011627 -11.02734375 96.0546875 C-11.00466179 94.46293953 -11.00466179 94.46293953 -10.98152161 92.83903503 C-10.93849419 89.44586182 -10.92979178 86.0535756 -10.921875 82.66015625 C-10.89874251 80.36130429 -10.8733798 78.06247361 -10.84570312 75.76367188 C-10.78270163 70.12492107 -10.75048393 64.48672817 -10.734375 58.84765625 C-4.464375 58.84765625 1.805625 58.84765625 8.265625 58.84765625 C8.5072755 66.74917174 8.72231714 74.65079117 8.91259766 82.55371094 C8.97881132 85.24287954 9.05516602 87.93147744 9.14013672 90.62011719 C9.25842171 94.48219356 9.35053445 98.34413859 9.4375 102.20703125 C9.50127838 104.013461 9.50127838 104.013461 9.56634521 105.85638428 C9.58666809 106.97724426 9.60699097 108.09810425 9.62792969 109.25292969 C9.65457703 110.23888123 9.68122437 111.22483276 9.7086792 112.24066162 C9.13507591 115.61582588 7.86982828 116.70087524 5.265625 118.84765625 C-15.09083856 133.24892372 -38.12171726 137.45999018 -62.52539062 133.29296875 C-74.58614832 130.86162237 -85.0395153 126.45117487 -94.734375 118.84765625 C-95.81912109 118.03361328 -95.81912109 118.03361328 -96.92578125 117.203125 C-111.16594986 105.74968214 -119.62237374 87.77163157 -121.734375 69.84765625 C-122.91976966 50.86299902 -119.27561203 34.2607785 -109.046875 18.09765625 C-108.65419434 17.47632813 -108.26151367 16.855 -107.85693359 16.21484375 C-106.8743414 14.71917177 -105.81081556 13.27727082 -104.734375 11.84765625 C-104.074375 11.84765625 -103.414375 11.84765625 -102.734375 11.84765625 C-102.48945312 11.265 -102.24453125 10.68234375 -101.9921875 10.08203125 C-96.07742755 -0.42493364 -79.75603905 -6.90908694 -68.6081543 -10.07910156 C-46.17845607 -15.99549655 -19.12019529 -14.40345837 0 0 Z " fill="currentColor" transform="translate(1542.734375,301.15234375)"/>
<path d="M0 0 C38.28 0 76.56 0 116 0 C116 14.94484903 116 14.94484903 110.6875 21 C110.14496582 21.66878174 109.60243164 22.33756348 109.04345703 23.02661133 C107.39285336 25.04585462 105.70288243 27.02477698 104 29 C103.03366904 30.1484899 102.06874494 31.29816551 101.10546875 32.44921875 C99.29951103 34.59745914 97.47798025 36.73121193 95.6484375 38.859375 C91.66929704 43.52738053 88.00147793 48.43357731 84.29003906 53.31445312 C82.01087723 56.29237388 79.69355322 59.24020689 77.375 62.1875 C76.90964844 62.77909912 76.44429687 63.37069824 75.96484375 63.98022461 C72.68979147 68.13724476 69.38756817 72.27187251 66.07421875 76.3984375 C64.09775733 78.87738911 62.14046275 81.37017591 60.18725586 83.86743164 C55.66428912 89.64985706 51.08230192 95.3774098 46.4375 101.0625 C39.76592497 109.23278366 33.32907868 117.56122843 27 126 C57.03 126.33 87.06 126.66 118 127 C118 132.61 118 138.22 118 144 C78.73 144 39.46 144 -1 144 C-1 127.95581254 -1 127.95581254 4.875 121.9375 C6.08104379 120.584773 7.28545393 119.23058784 8.48828125 117.875 C9.08721191 117.22144531 9.68614258 116.56789063 10.30322266 115.89453125 C12.72656853 113.18875227 14.88045726 110.34214417 17.0625 107.4375 C21.14382749 102.08613219 25.32501404 96.82480067 29.54370117 91.58129883 C32.71074263 87.63629868 35.81237003 83.65160531 38.875 79.625 C43.36941639 73.72057063 48.08661053 68.0126083 52.82324219 62.30175781 C57.17491069 57.04043187 61.36908466 51.68541493 65.5 46.25 C68.7613573 41.97867398 72.1459934 37.80486762 75.53955078 33.63818359 C79.91667312 28.22113362 83.88246092 22.66161623 88 17 C58.96 17 29.92 17 0 17 C0 11.39 0 5.78 0 0 Z " fill="currentColor" transform="translate(1038,290)"/>
<path d="M0 0 C0 0.66 0 1.32 0 2 C0.58910156 2.23847656 1.17820312 2.47695313 1.78515625 2.72265625 C9.98129668 7.44953089 14.88312212 20.36911721 17.3125 29.125 C18.33123912 36.34878646 18 43.70473303 18 51 C-11.04 51 -40.08 51 -70 51 C-65.94041818 62.3668291 -62.74995717 70.93902989 -52.625 77.4375 C-41.06393056 82.42071959 -28.52685969 84.29528755 -16.3828125 80.046875 C-9.92161077 77.20818309 -3.92079523 74.05941081 0 68 C3.93472548 69.31157516 5.12683424 71.33383447 7.6875 74.5625 C8.49574219 75.57441406 9.30398438 76.58632813 10.13671875 77.62890625 C10.75160156 78.41136719 11.36648438 79.19382812 12 80 C8.72814668 87.65136533 1.06856836 92.36685461 -6.15234375 95.89453125 C-14.33588071 99.071405 -21.51334666 100.50322887 -30.3125 100.375 C-31.3221582 100.36484863 -32.33181641 100.35469727 -33.37207031 100.34423828 C-50.76087269 99.98371827 -63.74422212 94.60101106 -76 82 C-86.67174548 70.20491289 -89.71977843 55.95235663 -89.3125 40.45703125 C-88.73429131 29.42529131 -85.71816264 18.87703288 -79 10 C-78.37480469 9.15953125 -77.74960938 8.3190625 -77.10546875 7.453125 C-58.18880021 -15.7101426 -23.43051448 -17.14016014 0 0 Z M-62.58203125 17.96484375 C-66.22725504 23.01139444 -70 29.54795724 -70 36 C-47.23 36 -24.46 36 -1 36 C-2.3407105 25.27431603 -6.17328577 18.56846394 -14.53515625 11.6953125 C-29.40122574 1.47047231 -51.1192465 3.72834813 -62.58203125 17.96484375 Z " fill="currentColor" transform="translate(1253,335)"/>
<path d="M0 0 C13.1410489 9.05357148 20.67949748 20.81864694 23.82421875 36.484375 C24.56135815 42.24623524 24.68531882 48.01941107 24.25 53.8125 C22.45011601 55.61238399 20.00000124 54.93243004 17.60444641 54.93692017 C16.79452744 54.93332489 15.98460846 54.92972961 15.15014648 54.92602539 C14.30143982 54.92617142 13.45273315 54.92631744 12.57830811 54.9264679 C9.75921109 54.92576848 6.94017929 54.91797478 4.12109375 54.91015625 C2.17196183 54.90829217 0.22282945 54.90686822 -1.7263031 54.90586853 C-6.86706832 54.90204255 -12.00780547 54.89221159 -17.14855957 54.88116455 C-22.39005148 54.87095215 -27.6315479 54.86637128 -32.87304688 54.86132812 C-43.16537694 54.85058939 -53.45768614 54.83351201 -63.75 54.8125 C-63.12817133 56.74233256 -62.50080328 58.67038084 -61.87109375 60.59765625 C-61.52232178 61.67152588 -61.1735498 62.74539551 -60.81420898 63.85180664 C-58.71714848 69.68595501 -55.24306652 73.64819445 -50.75 77.8125 C-49.63625 78.864375 -49.63625 78.864375 -48.5 79.9375 C-39.00843947 86.40901854 -25.96133518 87.15451877 -14.9296875 85.3515625 C-6.30787544 83.05421446 0.1347529 78.11305762 6.25 71.8125 C8.25 71.8125 8.25 71.8125 9.87109375 73.421875 C10.47050781 74.12828125 11.06992188 74.8346875 11.6875 75.5625 C12.28433594 76.25859375 12.88117188 76.9546875 13.49609375 77.671875 C15.14081098 79.67923589 16.71126108 81.72320312 18.25 83.8125 C14.02510722 93.31850875 3.42037741 98.10324382 -5.75 101.8125 C-21.62552998 106.61678998 -40.51157062 105.03955849 -55.3125 97.875 C-68.7699891 90.11983679 -77.06466061 79.13880888 -81.625 64.3125 C-85.39896784 47.23978834 -83.25514189 29.89202503 -73.9609375 15.07421875 C-57.91296341 -8.60079603 -24.20848389 -14.33835823 0 0 Z M-54.85546875 19.62109375 C-59.95602285 25.52090993 -62.48425425 32.21802552 -63.75 39.8125 C-40.98 39.8125 -18.21 39.8125 5.25 39.8125 C3.77511237 29.48828656 -0.21502899 22.11168767 -8.328125 15.46875 C-23.29557684 5.23294423 -41.71921591 7.62487074 -54.85546875 19.62109375 Z " fill="currentColor" transform="translate(1988.75,331.1875)"/>
<path d="M0 0 C1.01980957 0.00563965 2.03961914 0.0112793 3.09033203 0.01708984 C14.80328557 0.20597829 23.38388485 2.08996996 32.75 9.3125 C34.11125 10.2096875 34.11125 10.2096875 35.5 11.125 C42.72443453 18.14875579 45.81523746 28.51912235 46.0685091 38.36437607 C46.10781776 42.36084279 46.08113098 46.35519329 46.04296875 50.3515625 C46.03736373 52.08604564 46.03309792 53.82053358 46.03010559 55.55502319 C46.01872805 60.08914629 45.98932311 64.62297465 45.95599365 69.15698242 C45.92513869 73.79602066 45.91156749 78.43510717 45.89648438 83.07421875 C45.86444556 92.15379523 45.81173678 101.23307684 45.75 110.3125 C39.81 110.3125 33.87 110.3125 27.75 110.3125 C27.42 107.0125 27.09 103.7125 26.75 100.3125 C25.80125 101.22 24.8525 102.1275 23.875 103.0625 C15.24201357 110.48476273 4.98859845 111.50395426 -5.9375 111.5625 C-7.35192383 111.5934375 -7.35192383 111.5934375 -8.79492188 111.625 C-19.42177512 111.68342943 -28.78778927 108.87532005 -37.25 102.3125 C-44.45570232 94.76049775 -47.66183467 87.04263682 -47.4609375 76.515625 C-46.6046803 67.57249421 -42.9726958 60.67191151 -36.421875 54.625 C-23.89786776 45.06468913 -7.16557775 45.77690548 7.75 46.0625 C9.60414705 46.08262555 11.45831556 46.10086545 13.3125 46.1171875 C17.79221079 46.16063517 22.27085819 46.22931594 26.75 46.3125 C26.52002126 43.93403567 26.26678509 41.56188734 26 39.1875 C25.9071875 38.18976563 25.9071875 38.18976563 25.8125 37.171875 C25.23289755 32.24525416 23.64352167 29.27638944 20.75 25.3125 C20.75 24.6525 20.75 23.9925 20.75 23.3125 C9.80910641 17.76975655 -2.13996178 16.10125368 -14.17578125 19.19140625 C-21.03474265 21.46273445 -26.63193641 24.53193799 -32.26171875 29.0546875 C-32.91785156 29.46976562 -33.57398438 29.88484375 -34.25 30.3125 C-38.27874601 28.96958466 -38.91956988 27.10937518 -41.0625 23.5 C-41.70832031 22.44167969 -42.35414062 21.38335937 -43.01953125 20.29296875 C-44.25 17.3125 -44.25 17.3125 -43.68359375 15.109375 C-34.17179497 3.1872294 -14.3537515 -0.08239811 0 0 Z M-24.25 67.3125 C-27.36836003 71.18356763 -28.39517457 75.38563816 -28.25 80.3125 C-27.39391632 84.52412595 -26.0221347 87.49624332 -23.0625 90.625 C-13.62803066 96.28568161 -2.90233255 96.96281049 7.79296875 94.65625 C15.95310813 91.7211301 22.64932442 85.94083099 26.75 78.3125 C27.20417027 75.32985782 27.13254535 72.44525988 27 69.4375 C26.98195313 68.65375 26.96390625 67.87 26.9453125 67.0625 C26.89855148 65.14529811 26.82682003 63.22873285 26.75 61.3125 C22.59148622 61.26219228 18.43314448 61.22636293 14.27441406 61.20263672 C12.86650499 61.19272187 11.45861567 61.17918588 10.05078125 61.16162109 C-8.34704779 60.23537693 -8.34704779 60.23537693 -24.25 67.3125 Z " fill="currentColor" transform="translate(1623.25,323.6875)"/>
<path d="M0 0 C0.87011719 -0.01377686 1.74023438 -0.02755371 2.63671875 -0.04174805 C14.37624353 0.04125199 24.32925182 4.13535158 33.1875 11.8125 C34.2703125 13.0809375 34.2703125 13.0809375 35.375 14.375 C35.79265625 14.86355469 36.2103125 15.35210937 36.640625 15.85546875 C43.41843643 24.4502236 45.50732948 34.94719704 45.48852539 45.66552734 C45.48867142 46.36866058 45.48881744 47.07179382 45.4889679 47.79623413 C45.48827584 50.10116755 45.4805168 52.40601834 45.47265625 54.7109375 C45.47078956 56.31661942 45.46936684 57.92230192 45.46836853 59.52798462 C45.46456315 63.73982332 45.45474988 67.95162716 45.44366455 72.16345215 C45.43340777 76.46703622 45.42886179 80.77062596 45.42382812 85.07421875 C45.41312573 93.50783023 45.39554507 101.94140675 45.375 110.375 C39.105 110.375 32.835 110.375 26.375 110.375 C26.3656543 108.38315674 26.35630859 106.39131348 26.34667969 104.33911133 C26.31095436 97.70930438 26.25703257 91.07983383 26.19109726 84.45026112 C26.15182583 80.43630814 26.11953899 76.42256786 26.10400391 72.40844727 C26.08870156 68.52427551 26.05402162 64.64068935 26.00669098 60.75678062 C25.99201544 59.28551045 25.98396706 57.81415661 25.98311615 56.34281349 C25.97063361 45.56735779 25.64807681 33.70383241 18.125 25.25 C14.57752494 22.1745066 10.87739703 20.57756331 6.375 19.375 C5.59125 19.148125 4.8075 18.92125 4 18.6875 C-6.98335459 17.37995779 -16.45704233 19.07784251 -25.58203125 25.5703125 C-33.81412257 32.8422555 -35.85253799 41.89838291 -36.625 52.375 C-36.80742376 56.92889673 -36.8788312 61.48211329 -36.94140625 66.0390625 C-36.96218735 67.31228363 -36.98296844 68.58550476 -37.00437927 69.89730835 C-37.0583206 73.24758869 -37.10867644 76.59788226 -37.15722656 79.94824219 C-37.20787513 83.38090795 -37.26333254 86.81349587 -37.31835938 90.24609375 C-37.42495691 96.95566848 -37.52637463 103.66530355 -37.625 110.375 C-43.895 110.375 -50.165 110.375 -56.625 110.375 C-56.625 74.405 -56.625 38.435 -56.625 1.375 C-50.355 1.375 -44.085 1.375 -37.625 1.375 C-37.295 5.335 -36.965 9.295 -36.625 13.375 C-35.243125 12.281875 -33.86125 11.18875 -32.4375 10.0625 C-22.30491576 2.04717217 -12.74869848 0.11125892 0 0 Z " fill="currentColor" transform="translate(1351.625,323.625)"/>
<path d="M0 0 C11.04865482 8.03175269 15.61984358 18.46034743 17.76560974 31.70916748 C18.54183266 38.2238364 18.4312141 44.74808057 18.3828125 51.296875 C18.37907224 52.80429901 18.37623007 54.3117255 18.37423706 55.81915283 C18.36668019 59.74490327 18.34710224 63.67050057 18.3248291 67.59619141 C18.30419723 71.61879404 18.29519865 75.64142196 18.28515625 79.6640625 C18.26384697 87.52611903 18.22873193 95.38802269 18.1875 103.25 C11.9175 103.25 5.6475 103.25 -0.8125 103.25 C-0.842229 100.48943237 -0.842229 100.48943237 -0.87255859 97.6730957 C-0.94076442 91.54229363 -1.01756842 85.41164457 -1.10002708 79.28101826 C-1.14963797 75.56978792 -1.19596595 71.85858131 -1.234375 68.1472168 C-1.2716791 64.55496554 -1.31815004 60.96293201 -1.37056351 57.37087059 C-1.39768426 55.35672103 -1.41569293 53.34245525 -1.43344116 51.32820129 C-1.59870559 32.42296816 -1.59870559 32.42296816 -11.1875 16.9375 C-19.43353827 11.6364754 -28.72352553 9.85418642 -38.33203125 11.74609375 C-47.1842081 14.15290681 -54.78027799 18.37142742 -59.8125 26.25 C-62.87328894 33.10090649 -63.91115207 40.15564486 -64.01782227 47.62255859 C-64.03776749 48.86339203 -64.05771271 50.10422546 -64.07826233 51.38265991 C-64.09524121 52.72125121 -64.11212021 54.05984377 -64.12890625 55.3984375 C-64.14950178 56.77992335 -64.1704989 58.16140327 -64.19187927 59.5428772 C-64.24683178 63.16281298 -64.29635824 66.78280308 -64.34472656 70.40283203 C-64.39513861 74.10323875 -64.45072138 77.80356747 -64.50585938 81.50390625 C-64.61311243 88.75253971 -64.71415062 96.00123927 -64.8125 103.25 C-71.0825 103.25 -77.3525 103.25 -83.8125 103.25 C-83.8125 67.28 -83.8125 31.31 -83.8125 -5.75 C-77.5425 -5.75 -71.2725 -5.75 -64.8125 -5.75 C-64.4825 -1.79 -64.1525 2.17 -63.8125 6.25 C-62.69875 5.1775 -61.585 4.105 -60.4375 3 C-44.70743284 -10.75686085 -17.16557895 -10.48848397 0 0 Z " fill="currentColor" transform="translate(2120.8125,330.75)"/>
<path d="M0 0 C0 5.94 0 11.88 0 18 C-1.918125 18.0825 -3.83625 18.165 -5.8125 18.25 C-15.12845271 18.98066296 -23.36027875 21.19833433 -30 28 C-38.30872225 38.44525083 -38.14980326 51.08547625 -38.31640625 63.80859375 C-38.33700985 65.14380995 -38.35800714 66.47902012 -38.37937927 67.81422424 C-38.43424863 71.30755702 -38.48381094 74.80094518 -38.53222656 78.29437256 C-38.58270023 81.86752174 -38.63825049 85.44059171 -38.69335938 89.01367188 C-38.80051033 96.00904714 -38.90157876 103.00449651 -39 110 C-45.27 110 -51.54 110 -58 110 C-58 74.03 -58 38.06 -58 1 C-51.73 1 -45.46 1 -39 1 C-38.67 4.96 -38.34 8.92 -38 13 C-36.783125 11.906875 -35.56625 10.81375 -34.3125 9.6875 C-24.19924304 0.60270985 -13.2014389 -0.4304817 0 0 Z " fill="currentColor" transform="translate(1761,324)"/>
<path d="M0 0 C6.52010014 3.86238313 11.03171562 9.30493006 13.16796875 16.59765625 C14.15306732 23.01084898 12.60890809 29.08203648 9.05078125 34.46484375 C4.9071922 39.36456219 -0.4816921 42.40782264 -6.8125 43.49609375 C-13.31286854 43.76553908 -18.59156092 41.75127272 -24.13671875 38.52734375 C-29.01776336 33.38245889 -31.73442127 27.58544682 -32.01171875 20.46484375 C-31.63017155 13.34597632 -29.27933452 8.48790171 -24.01171875 3.71484375 C-17.42060388 -1.7599106 -8.03446005 -2.98569249 0 0 Z " fill="currentColor" transform="translate(726.44921875,232.91015625)"/>
</svg>
          <span class="zen-date">{{ today }}</span>
          <span class="zen-greeting">Hello, {{ user.username }}</span>
        </div>
        <div class="zen-header-right">
          <nav class="menu-bar">
            <div v-if="user?.stats" class="stats-inline">
              <span class="stat-separator">Tot. Sessions</span>
              <span class="stat-compact" :title="`${user.stats.totalSessions} total sessions`">
                {{ user.stats.totalSessions }}
              </span>
              <span class="stat-separator">Tot. Minutes</span>
              <span class="stat-compact" :title="`${formatMinutes(user.stats.totalMinutes)} total time`">
                {{ formatMinutes(user.stats.totalMinutes) }}
              </span>
              <span class="stat-separator">Day Streak</span>
              <span class="stat-compact" :title="`${user.stats.currentStreak} day streak`">
                {{ user.stats.currentStreak }}ðŸ”¥
              </span>
            </div>
            <button 
              class="menu-item"
              @click="showBreathing = true"
              aria-label="Breathing exercises"
            >
              Breathe
            </button>
            <button 
              class="menu-item"
              @click="showCalendar = true"
              aria-label="View meditation history"
            >
              Calendar
            </button>
            <button 
              class="menu-item menu-logout" 
              @click="handleLogout" 
              aria-label="Logout from your account"
            >
              Logout
            </button>
          </nav>
        </div>
      </div>
      <MeditationCalendar v-if="showCalendar && !meditationActive" :meditations="meditations" @close="showCalendar = false" />
      <SessionNotes v-if="showNotes" :duration="completedMeditationDuration" @save="saveSessionNotes" @skip="skipSessionNotes" @close="showNotes = false" />
      <BreathingExercise v-if="showBreathing" @close="showBreathing = false" />

      <div v-if="!meditationActive" class="zen-main">
        <div class="zen-center">
        <span class="zen-phrase">{{ currentPhrase }}</span>
        <span class="zen-loader">
          <svg width="32" height="32" viewBox="0 0 32 32">
            <rect x="10" y="15" width="12" height="2" rx="1" fill="#F0F8FF">
              <animateTransform attributeName="transform" type="rotate" from="0 16 16" to="360 16 16" dur="2.5s" repeatCount="indefinite"/>
            </rect>
          </svg>
        </span>
        <div v-if="!meditationActive" class="meditation-control-bar">
          <button
            v-for="duration in [1, 5, 10, 15, 20, 30]"
            :key="duration"
            :class="['duration-btn', { active: selectedDuration === duration }]"
            @click="selectedDuration = duration"
            :aria-label="`Set meditation duration to ${duration} minutes`"
          >
            {{ duration }}
          </button>
          <button class="start-meditation-btn" @click="startMeditation" :aria-label="`Start a ${selectedDuration}-minute meditation session`">
            Begin
          </button>
        </div>
        <div v-else class="meditation-timer">
          <div class="timer-display" aria-live="polite" aria-label="Meditation timer">{{ formatTime(meditationSeconds) }}</div>
          <button class="meditation-btn" @click="stopMeditation" aria-label="Stop the current meditation session">Stop</button>
        </div>
      </div>
    </div>
      <div v-if="meditationActive" class="zen-meditation-overlay">
        <component :is="ANIMATIONS[meditationAnimationIdx]" />
        <div class="meditation-timer meditation-timer-overlay">
          <div class="timer-display" aria-live="polite" aria-label="Meditation timer">{{ formatTime(meditationSeconds) }}</div>
          <button class="meditation-btn" @click="stopMeditation" aria-label="Stop the current meditation session">Stop</button>
        </div>
      </div>
    </template>
  </div>
</template>

<script setup lang="ts">
import MeditationCalendar from './MeditationCalendar.vue'
import SessionNotes from './SessionNotes.vue'
import BreathingExercise from './BreathingExercise.vue'
import { ref, onMounted, onUnmounted, watch } from 'vue'
import ZenWindAnimation from './ZenWindAnimation.vue'
import ZenWavesAnimation from './ZenWavesAnimation.vue'
import MonkAuth from './MonkAuth.vue'
import { apiRequest } from '../api'
// Zen phrases
const phrases = [
  'Breathe in calm, breathe out tension.',
  'Let your thoughts settle like stones in a pond.',
  'Simplicity is the ultimate sophistication.',
  'Be present. Be mindful. Be at peace.',
  'The quieter you become, the more you can hear.',
  'Flow like water, steady and clear.',
  'In stillness, the world is transformed.',
  'Let go and just be.',
  'Balance is not something you find, itâ€™s something you create.',
  'Peace comes from within.'
]
const currentPhrase = ref(phrases[Math.floor(Math.random() * phrases.length)])
let phraseIntervalId: number | undefined

const emit = defineEmits(['meditation-active', 'theme-changed'])
const meditationActive = ref(false)

// Watch meditationActive and emit event on change
watch(meditationActive, (val) => {
  emit('meditation-active', val)
})
const meditationSeconds = ref(600) // 10 minutes
const selectedDuration = ref(10) // minutes
let meditationIntervalId: number | undefined

const showCalendar = ref(false)
const showNotes = ref(false)
const showBreathing = ref(false)
const meditations = ref<Array<{ Date: string | { $date: string }, Username?: string, duration?: number, notes?: string }>>([])  
const completedMeditationDuration = ref(0)

const audio = ref<HTMLAudioElement | null>(null)
const alertAudio = ref<HTMLAudioElement | null>(null)

function setRandomPhrase() {
  let next
  do {
    next = phrases[Math.floor(Math.random() * phrases.length)]
  } while (next === currentPhrase.value && phrases.length > 1)
  currentPhrase.value = next
}

async function fetchMeditations() {
  try {
    const res = await apiRequest('/meditations', 'GET')
    meditations.value = res.meditations || []
  } catch (e) {
    meditations.value = []
  }
}

async function fetchUserData() {
  try {
    const res = await apiRequest('/me')
    user.value = res.user
    emit('theme-changed', res.user.theme)
  } catch (e) {
    // Silently handle error - user will be logged out if token invalid
  }
}

function playAlert() {
  if (!alertAudio.value) {
    alertAudio.value = new Audio('/alert.mp3')
  }
  alertAudio.value.currentTime = 0
  alertAudio.value.play()
}

async function stopMeditationAudioSmooth() {
  if (audio.value) {
    const fadeDuration = 2 // seconds
    const step = 0.05
    let currentVolume = audio.value.volume
    while (currentVolume > 0.01) {
      currentVolume = Math.max(0, currentVolume - step)
      audio.value.volume = currentVolume
      await new Promise(r => setTimeout(r, fadeDuration * 50))
    }
    audio.value.pause()
    audio.value.currentTime = 0
    audio.value.volume = 1 // reset for next play
  }
}

function playMeditationAudio() {
  if (!audio.value) {
    audio.value = new Audio('/meditation.mp3')
    audio.value.loop = true
  }
  audio.value.currentTime = 0
  audio.value.volume = 1
  audio.value.play()
}

async function stopMeditation() {
  meditationActive.value = false
  if (meditationIntervalId) clearInterval(meditationIntervalId)
  await stopMeditationAudioSmooth()
  playAlert()
}

async function finishMeditation() {
  meditationActive.value = false
  if (meditationIntervalId) clearInterval(meditationIntervalId)
  await stopMeditationAudioSmooth()
  playAlert()
  
  completedMeditationDuration.value = (selectedDuration.value * 60) - meditationSeconds.value
  showNotes.value = true
}

async function saveSessionNotes(notes: string) {
  try {
    await apiRequest('/meditations', 'POST', {
      Date: new Date().toISOString(),
      duration: Math.round(completedMeditationDuration.value / 60),
      notes
    })
    await fetchMeditations()
    await fetchUserData()
    showNotes.value = false
  } catch (e) {
    // Error saving meditation - UI can handle gracefully
  }
}

async function skipSessionNotes() {
  try {
    await apiRequest('/meditations', 'POST', {
      Date: new Date().toISOString(),
      duration: Math.round(completedMeditationDuration.value / 60),
      notes: ''
    })
    await fetchMeditations()
    await fetchUserData()
    showNotes.value = false
  } catch (e) {
    // Error saving meditation - UI can handle gracefully
  }
}

const ANIMATIONS = [ZenWindAnimation, ZenWavesAnimation]
const meditationAnimationIdx = ref(0)

async function startMeditation() {
  if (meditationActive.value) return
  meditationActive.value = true
  meditationSeconds.value = selectedDuration.value * 60
  meditationAnimationIdx.value = Math.floor(Math.random() * ANIMATIONS.length)
  meditationIntervalId = window.setInterval(() => {
    if (meditationSeconds.value > 0) {
      meditationSeconds.value--
    } else {
      finishMeditation()
    }
  }, 1000)
  playAlert()
  playMeditationAudio()
}

onMounted(async () => {
  phraseIntervalId = window.setInterval(setRandomPhrase, 10000)
  if (token.value) {
    try {
      await fetchUserData()
      await fetchMeditations()
    } catch (e) {
      // Invalid token or network error - logout user
      localStorage.removeItem('zen_token')
      token.value = null
    }
  }
})
onUnmounted(() => {
  if (phraseIntervalId) clearInterval(phraseIntervalId)
  if (meditationIntervalId) clearInterval(meditationIntervalId)
})

function formatTime(sec: number) {
  const m = Math.floor(sec / 60)
  const s = sec % 60
  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`
}

function formatMinutes(minutes: number): string {
  if (minutes < 60) {
    return `${minutes} min`
  }
  const hours = Math.floor(minutes / 60)
  const mins = minutes % 60
  return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`
}

const today = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })

const user = ref<{ username: string, theme?: string, stats?: any, goals?: any } | null>(null)
const token = ref<string | null>(localStorage.getItem('zen_token'))

async function handleAuth(evt: { user: any, token: string }) {
  user.value = evt.user
  token.value = evt.token
  await fetchUserData()
  await fetchMeditations()
  if (evt.user && evt.user.theme) {
    emit('theme-changed', evt.user.theme)
  }
}

function handleLogout() {
  user.value = null
  token.value = null
  localStorage.removeItem('zen_token')
}

// Optionally, fetch meditations when calendar is opened
watch(showCalendar, (val) => { if (val && user.value) fetchMeditations() })
</script>

<style scoped>
.logo {
  width: 50px;
  margin-bottom: 2rem;
  color: var(--text1);
}
.zen-bg {
  min-height: 100vh;
  width: 100vw;
  background: color-mix(in srgb, var(--base1) 70%, var(--base2) 30%);
  display: flex;
  align-items: center;
  justify-content: center;
}
.zen-main {
  display: flex;
  width: 100%;
  height: 100vh;
  align-items: center;
  justify-content: center;
  padding: 0 2rem;
}
.goals-horizontal {
  padding: 1rem 2rem;
  max-width: 1200px;
  margin: 0 auto;
}
.zen-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.zen-loader {
  display: flex;
  align-items: center;
  justify-content: center;
}

.zen-date {
  font-size: 1.1rem;
  color: var(--text1);
}
.zen-greeting {
  font-size: 1.1rem;
  color: var(--text2);
}

.zen-phrase {
  color: var(--text1);
  text-align: center;
  cursor: default;
}
.meditation-timer {
  margin-top: 2.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2rem;
}

/* Compact Meditation Control Bar */
.meditation-control-bar {
  position: absolute;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 0.1rem;
  padding: 0.25rem;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 6px;
}

.duration-btn {
  padding: 0.4rem;
  background: transparent;
  border: none;
  color: var(--text2);
  font-size: 0.8rem;
  font-weight: 400;
  cursor: pointer;
  transition: all 0.15s;
  border-radius: 4px;
  min-width: 40px;
}

.duration-btn:hover {
  background: var(--input-bg-focus);
  color: var(--text1);
}

.duration-btn.active {
  background: var(--button-bg);
  color: var(--text1);
}

.start-meditation-btn {
  padding: 0.4rem 1rem;
  background: var(--button-bg);
  border: none;
  border-left: 1px solid var(--input-border);
  color: var(--text1);
  font-size: 0.8rem;
  font-weight: 400;
  cursor: pointer;
  border-radius: 0 4px 4px 0;
  margin-left: 0.25rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.15s;
}

.start-meditation-btn:hover {
  background: var(--button-bg-hover);
}

.start-meditation-btn:active {
  transform: scale(0.98);
}

.meditation-btn {
  background: transparent;
  position: absolute;
  bottom: 2rem;
  color: var(--text1);
  cursor: pointer;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
  border: none;
  outline: none;
  padding: 0.6em 1.6em;
  border-radius: 999px;
  font-size: 1.1rem;
  letter-spacing: 0.02em;
}

.meditation-btn:hover, .meditation-btn:focus {
  background: var(--blur1);
  color: var(--text2);
  box-shadow: 0 2px 16px 0 var(--input-border);
}

.timer-display {
  font-size: 1.3rem;
  color: var(--text1);
  position: absolute;
  bottom: 6rem;
}

.zen-header {
  position: absolute;
  top: 1.2rem;
  left: 0;
  width: 100vw;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
  pointer-events: none;
  z-index: 10;
  padding: 0 2.2rem;
  box-sizing: border-box;
}
.zen-header-left {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.2rem;
  pointer-events: auto;
  cursor: default;
  color: var(--text1);
}
.zen-header-right {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.3rem;
  pointer-events: auto;
}
.zen-calendar {
  margin: 0;
  opacity: 0.7;
  pointer-events: auto;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: opacity 0.2s;
}
.zen-calendar svg {
  display: block;
  opacity: 0.80;
}
.zen-calendar:hover svg {
  opacity: 1;
}
.logout-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  margin: 0;
  margin-top: 0.1rem;
  transition: color 0.2s;
  pointer-events: auto;
  display: flex;
  align-items: center;
  padding: 0.2em 0.4em;
  opacity: 0.70;
}

.logout-btn:hover {
  opacity: 1;
}

.logout-btn svg {
  display: block;
  transition: stroke 0.2s;
}

/* Professional Menu Bar - Y Combinator Style */
.menu-bar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.35rem;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 6px;
}

.menu-item {
  padding: 0.4rem 0.85rem;
  background: transparent;
  border: none;
  color: var(--text2);
  font-size: 0.875rem;
  font-weight: 400;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.15s ease;
  letter-spacing: 0.01em;
}

.menu-item:hover {
  background: var(--input-bg-focus);
  color: var(--text1);
}

.menu-item:active {
  transform: scale(0.98);
}

.menu-logout {
  color: color-mix(in srgb, var(--text2) 70%, transparent 30%);
  border-left: 1px solid var(--input-bg-focus);
  margin-left: 0.25rem;
  padding-left: 1rem;
}

.menu-logout:hover {
  color: var(--text1);
  background: var(--input-bg-focus);
}

/* Inline Compact Stats */
.stats-inline {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0.85rem;
  border-right: 1px solid var(--input-bg-focus);
  margin-right: 0.25rem;
}

.stat-compact {
  font-size: 0.8rem;
  color: var(--text2);
  font-variant-numeric: tabular-nums;
  cursor: default;
  transition: color 0.2s;
}

.stat-compact:hover {
  color: var(--text1);
}

.stat-separator {
  color: color-mix(in srgb, var(--text2) 50%, transparent 50%);
  font-size: 0.8rem;
}

.zen-meditation-overlay {
  position: fixed;
  inset: 0;
  background: var(--base1);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}
.meditation-timer-overlay {
  position: absolute;
  bottom: 3.5rem;
  left: 0;
  width: 100vw;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 1010;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
  .zen-header {
    flex-direction: column;
    gap: 0rem;
    top: 0.5rem;
  }

  .zen-header-left {
    width: 100%;
    align-items: center;
  }
  
  .zen-date,
  .zen-greeting {
    visibility: hidden;
  }

  .zen-header-right {
    width: 100%;
  }

  .menu-bar {
    width: 100%;
    flex-wrap: wrap;
    gap: 0.3rem;
    padding: 0.5rem;
  }

  .stats-inline {
    width: 100%;
    display: flex;
    border-right: none;
    border-bottom: 1px solid var(--input-bg-focus);
    padding-bottom: 0.5rem;
    margin-bottom: 0.3rem;
    margin-right: 0;
    flex-direction: row;
  }

  .stat-compact,
  .stat-separator {
    font-size: 0.7rem;
  }

  .menu-item {
    flex: 1;
    text-align: center;
    font-size: 0.8rem;
    padding: 0.5rem 0.5rem;
  }

  .menu-logout {
    border-left: none;
    margin-left: 0;
    padding-left: 0.5rem;
  }

  .zen-main {
    padding: 0 1rem;
  }

  .zen-phrase {
    font-size: 1.1rem;
    padding: 0 1rem;
    margin-top: 8rem;
  }

  .zen-center {
    width: 100%;
  }

  .meditation-control-bar {
    bottom: 1.5rem;
    width: calc(100% - 2rem);
    left: 50%;
    flex-wrap: wrap;
    justify-content: center;
    padding: 0.3rem;
    gap: 0.3rem;
  }

  .duration-btn {
    min-width: 45px;
    padding: 0.6rem 0.5rem;
    font-size: 0.85rem;
  }

  .start-meditation-btn {
    flex: 1 1 100%;
    margin-left: 0;
    margin-top: 0.3rem;
    border-left: none;
    border-top: 1px solid var(--input-border);
    border-radius: 4px;
    padding: 0.7rem 1rem;
    font-size: 0.85rem;
  }

  .timer-display {
    font-size: 2.5rem;
    bottom: 8rem;
  }

  .meditation-btn {
    bottom: 1.5rem;
    font-size: 1rem;
    padding: 0.7em 2em;
  }

  .meditation-timer-overlay {
    bottom: 2rem;
  }
}

@media (max-width: 480px) {
  .zen-header {
    padding: 0.75rem;
  }

  .zen-header-left svg {
    width: 120px;
  }

  .zen-date,
  .zen-greeting {
    font-size: 0.8rem;
  }

  .stats-inline {
    flex-direction: row;
    justify-content: space-between;
    gap: 0.25rem;
    padding: 0.35rem 0.5rem;
  }

  .stat-compact,
  .stat-separator {
    font-size: 0.65rem;
  }

  .menu-item {
    font-size: 0.75rem;
    padding: 0.5rem 0.4rem;
  }

  .zen-phrase {
    font-size: 1rem;
    margin-top: 10rem;
  }

  .meditation-control-bar {
    width: calc(100% - 1.5rem);
    bottom: 1rem;
  }

  .duration-btn {
    min-width: 40px;
    padding: 0.5rem 0.4rem;
    font-size: 0.75rem;
  }

  .start-meditation-btn {
    padding: 0.65rem 0.8rem;
    font-size: 0.8rem;
  }

  .timer-display {
    font-size: 2rem;
    bottom: 7rem;
  }

  .meditation-btn {
    bottom: 1rem;
    font-size: 0.9rem;
    padding: 0.6em 1.8em;
  }

  .meditation-timer-overlay {
    bottom: 1.5rem;
  }
}

/* Landscape orientation on mobile */
@media (max-height: 500px) and (max-width: 900px) {
  .zen-header {
    position: fixed;
    top: 0.5rem;
    padding: 0.5rem 1rem;
  }

  .zen-header-left svg {
    width: 100px;
  }

  .zen-date,
  .zen-greeting {
    display: none;
  }

  .stats-inline {
    flex-direction: row;
    border-right: 1px solid var(--input-bg-focus);
    border-bottom: none;
    padding: 0.3rem 0.5rem;
  }

  .zen-phrase {
    margin-top: 4rem;
    font-size: 0.9rem;
  }

  .meditation-control-bar {
    bottom: 0.75rem;
    gap: 0.2rem;
    padding: 0.3rem;
  }

  .duration-btn {
    padding: 0.4rem 0.4rem;
    font-size: 0.7rem;
    min-width: 35px;
  }

  .start-meditation-btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.75rem;
    margin-top: 0;
    flex: 0 0 auto;
  }

  .timer-display {
    font-size: 1.8rem;
    bottom: 3.5rem;
  }

  .meditation-btn {
    bottom: 0.75rem;
    font-size: 0.85rem;
    padding: 0.5em 1.5em;
  }
}

/* Very small screens */
@media (max-width: 360px) {
  .zen-header-left svg {
    width: 100px;
  }

  .stats-inline {
    font-size: 0.6rem;
  }

  .menu-item {
    font-size: 0.7rem;
    padding: 0.45rem 0.3rem;
  }

  .duration-btn {
    min-width: 35px;
    padding: 0.45rem 0.3rem;
    font-size: 0.7rem;
  }

  .start-meditation-btn {
    font-size: 0.75rem;
  }
}

</style>
